<template>
  <nav class="nav-bar">
    <div class="max-w-screen-xl mx-auto px-4 py-3 flex items-center justify-between">
      <!-- Logo & Back button -->
      <div class="flex items-center space-x-4">
        <button
            v-if="showBackButton"
            @click="goBack"
            class="text-button2 border-button2-border hover:text-button2-hover transition"
        >
          ‚Üê Back
        </button>
        <router-link to="/" class="block text-text1 hover:text-button1-hover transition-transform transform hover:scale-105 w-36 sm:w-60">
          <div class="w-fill h-auto">
            <svg  viewBox="0 0 993 169" fill="none" xmlns="http://www.w3.org/2000/svg" class="fill-current">
              <path d="M166.284 128V58.1818H213.943V71.8864H183.159V86.2045H210.909V99.9432H183.159V128H166.284ZM239.111 58.1818V128H222.44V58.1818H239.111ZM274.199 128.989C268.722 128.989 263.994 127.909 260.017 125.75C256.063 123.568 253.017 120.466 250.881 116.443C248.767 112.398 247.71 107.591 247.71 102.023C247.71 96.6136 248.778 91.8864 250.915 87.8409C253.051 83.7727 256.062 80.6136 259.949 78.3636C263.835 76.0909 268.415 74.9545 273.688 74.9545C277.415 74.9545 280.824 75.5341 283.915 76.6932C287.006 77.8523 289.676 79.5682 291.926 81.8409C294.176 84.1136 295.926 86.9205 297.176 90.2614C298.426 93.5795 299.051 97.3864 299.051 101.682V105.841H253.54V96.1591H283.54C283.517 94.3864 283.097 92.8068 282.278 91.4205C281.46 90.0341 280.335 88.9545 278.903 88.1818C277.494 87.3864 275.869 86.9886 274.028 86.9886C272.165 86.9886 270.494 87.4091 269.017 88.25C267.54 89.0682 266.369 90.1932 265.506 91.625C264.642 93.0341 264.188 94.6364 264.142 96.4318V106.284C264.142 108.42 264.563 110.295 265.403 111.909C266.244 113.5 267.438 114.739 268.983 115.625C270.528 116.511 272.369 116.955 274.506 116.955C275.983 116.955 277.324 116.75 278.528 116.341C279.733 115.932 280.767 115.33 281.631 114.534C282.494 113.739 283.142 112.761 283.574 111.602L298.881 112.045C298.244 115.477 296.847 118.466 294.688 121.011C292.551 123.534 289.744 125.5 286.267 126.909C282.79 128.295 278.767 128.989 274.199 128.989ZM307.565 128V75.6364H324.236V128H307.565ZM315.918 69.5341C313.577 69.5341 311.565 68.7614 309.884 67.2159C308.202 65.6477 307.361 63.7614 307.361 61.5568C307.361 59.375 308.202 57.5114 309.884 55.9659C311.565 54.3977 313.577 53.6136 315.918 53.6136C318.281 53.6136 320.293 54.3977 321.952 55.9659C323.634 57.5114 324.474 59.375 324.474 61.5568C324.474 63.7614 323.634 65.6477 321.952 67.2159C320.293 68.7614 318.281 69.5341 315.918 69.5341ZM351.517 98.1364V128H334.847V75.6364H350.699V85.25H351.278C352.438 82.0455 354.415 79.5341 357.21 77.7159C360.006 75.875 363.335 74.9545 367.199 74.9545C370.881 74.9545 374.074 75.7841 376.778 77.4432C379.506 79.0795 381.619 81.375 383.119 84.3295C384.642 87.2614 385.392 90.6932 385.369 94.625V128H368.699V97.8977C368.722 94.9886 367.983 92.7159 366.483 91.0795C365.006 89.4432 362.949 88.625 360.312 88.625C358.562 88.625 357.017 89.0114 355.676 89.7841C354.358 90.5341 353.335 91.6136 352.608 93.0227C351.903 94.4318 351.54 96.1364 351.517 98.1364ZM441.406 91.625L426.099 92.0341C425.94 90.9432 425.509 89.9773 424.804 89.1364C424.099 88.2727 423.179 87.6023 422.043 87.125C420.929 86.625 419.634 86.375 418.156 86.375C416.224 86.375 414.577 86.7614 413.213 87.5341C411.872 88.3068 411.213 89.3523 411.236 90.6705C411.213 91.6932 411.622 92.5795 412.463 93.3295C413.327 94.0795 414.861 94.6818 417.065 95.1364L427.156 97.0455C432.384 98.0455 436.27 99.7045 438.815 102.023C441.384 104.341 442.679 107.409 442.702 111.227C442.679 114.818 441.611 117.943 439.497 120.602C437.406 123.261 434.543 125.33 430.906 126.807C427.27 128.261 423.111 128.989 418.429 128.989C410.952 128.989 405.054 127.455 400.736 124.386C396.44 121.295 393.986 117.159 393.372 111.977L409.838 111.568C410.202 113.477 411.145 114.932 412.668 115.932C414.19 116.932 416.134 117.432 418.497 117.432C420.634 117.432 422.372 117.034 423.713 116.239C425.054 115.443 425.736 114.386 425.759 113.068C425.736 111.886 425.213 110.943 424.19 110.239C423.168 109.511 421.565 108.943 419.384 108.534L410.247 106.795C404.997 105.841 401.088 104.08 398.52 101.511C395.952 98.9205 394.679 95.625 394.702 91.625C394.679 88.125 395.611 85.1364 397.497 82.6591C399.384 80.1591 402.065 78.25 405.543 76.9318C409.02 75.6136 413.122 74.9545 417.849 74.9545C424.94 74.9545 430.531 76.4432 434.622 79.4205C438.713 82.375 440.974 86.4432 441.406 91.625ZM475.352 128.989C469.852 128.989 465.125 127.864 461.17 125.614C457.239 123.341 454.205 120.182 452.068 116.136C449.955 112.068 448.898 107.352 448.898 101.989C448.898 96.6023 449.955 91.8864 452.068 87.8409C454.205 83.7727 457.239 80.6136 461.17 78.3636C465.125 76.0909 469.852 74.9545 475.352 74.9545C480.852 74.9545 485.568 76.0909 489.5 78.3636C493.455 80.6136 496.489 83.7727 498.602 87.8409C500.739 91.8864 501.807 96.6023 501.807 101.989C501.807 107.352 500.739 112.068 498.602 116.136C496.489 120.182 493.455 123.341 489.5 125.614C485.568 127.864 480.852 128.989 475.352 128.989ZM475.455 116.409C477.455 116.409 479.148 115.795 480.534 114.568C481.92 113.341 482.977 111.636 483.705 109.455C484.455 107.273 484.83 104.75 484.83 101.886C484.83 98.9773 484.455 96.4318 483.705 94.25C482.977 92.0682 481.92 90.3636 480.534 89.1364C479.148 87.9091 477.455 87.2955 475.455 87.2955C473.386 87.2955 471.636 87.9091 470.205 89.1364C468.795 90.3636 467.716 92.0682 466.966 94.25C466.239 96.4318 465.875 98.9773 465.875 101.886C465.875 104.75 466.239 107.273 466.966 109.455C467.716 111.636 468.795 113.341 470.205 114.568C471.636 115.795 473.386 116.409 475.455 116.409ZM510.347 147.636V75.6364H526.847V84.6023H527.358C528.04 83.0114 529.006 81.4773 530.256 80C531.528 78.5227 533.142 77.3182 535.097 76.3864C537.074 75.4318 539.438 74.9545 542.188 74.9545C545.824 74.9545 549.222 75.9091 552.381 77.8182C555.562 79.7273 558.131 82.6705 560.085 86.6477C562.04 90.625 563.017 95.6932 563.017 101.852C563.017 107.784 562.074 112.75 560.188 116.75C558.324 120.75 555.801 123.75 552.619 125.75C549.46 127.75 545.949 128.75 542.085 128.75C539.449 128.75 537.165 128.318 535.233 127.455C533.301 126.591 531.676 125.455 530.358 124.045C529.062 122.636 528.063 121.125 527.358 119.511H527.017V147.636H510.347ZM526.676 101.818C526.676 104.636 527.051 107.091 527.801 109.182C528.574 111.273 529.676 112.898 531.108 114.057C532.562 115.193 534.301 115.761 536.324 115.761C538.369 115.761 540.108 115.193 541.54 114.057C542.972 112.898 544.051 111.273 544.778 109.182C545.528 107.091 545.903 104.636 545.903 101.818C545.903 99 545.528 96.5568 544.778 94.4886C544.051 92.4205 542.972 90.8182 541.54 89.6818C540.131 88.5455 538.392 87.9773 536.324 87.9773C534.278 87.9773 532.54 88.5341 531.108 89.6477C529.676 90.7614 528.574 92.3523 527.801 94.4205C527.051 96.4886 526.676 98.9545 526.676 101.818ZM571.753 147.636V75.6364H588.253V84.6023H588.764C589.446 83.0114 590.412 81.4773 591.662 80C592.935 78.5227 594.548 77.3182 596.503 76.3864C598.48 75.4318 600.844 74.9545 603.594 74.9545C607.23 74.9545 610.628 75.9091 613.787 77.8182C616.969 79.7273 619.537 82.6705 621.491 86.6477C623.446 90.625 624.423 95.6932 624.423 101.852C624.423 107.784 623.48 112.75 621.594 116.75C619.73 120.75 617.207 123.75 614.026 125.75C610.866 127.75 607.355 128.75 603.491 128.75C600.855 128.75 598.571 128.318 596.639 127.455C594.707 126.591 593.082 125.455 591.764 124.045C590.469 122.636 589.469 121.125 588.764 119.511H588.423V147.636H571.753ZM588.082 101.818C588.082 104.636 588.457 107.091 589.207 109.182C589.98 111.273 591.082 112.898 592.514 114.057C593.969 115.193 595.707 115.761 597.73 115.761C599.776 115.761 601.514 115.193 602.946 114.057C604.378 112.898 605.457 111.273 606.185 109.182C606.935 107.091 607.31 104.636 607.31 101.818C607.31 99 606.935 96.5568 606.185 94.4886C605.457 92.4205 604.378 90.8182 602.946 89.6818C601.537 88.5455 599.798 87.9773 597.73 87.9773C595.685 87.9773 593.946 88.5341 592.514 89.6477C591.082 90.7614 589.98 92.3523 589.207 94.4205C588.457 96.4886 588.082 98.9545 588.082 101.818ZM648.193 114.261L648.261 94.3864H650.58L665.307 75.6364H684.193L662.307 102.5H657.909L648.193 114.261ZM633.159 128V58.1818H649.83V128H633.159ZM665.682 128L651.977 106.25L662.955 94.4205L684.943 128H665.682ZM712.446 128.989C706.946 128.989 702.219 127.864 698.264 125.614C694.332 123.341 691.298 120.182 689.162 116.136C687.048 112.068 685.991 107.352 685.991 101.989C685.991 96.6023 687.048 91.8864 689.162 87.8409C691.298 83.7727 694.332 80.6136 698.264 78.3636C702.219 76.0909 706.946 74.9545 712.446 74.9545C717.946 74.9545 722.662 76.0909 726.594 78.3636C730.548 80.6136 733.582 83.7727 735.696 87.8409C737.832 91.8864 738.901 96.6023 738.901 101.989C738.901 107.352 737.832 112.068 735.696 116.136C733.582 120.182 730.548 123.341 726.594 125.614C722.662 127.864 717.946 128.989 712.446 128.989ZM712.548 116.409C714.548 116.409 716.241 115.795 717.628 114.568C719.014 113.341 720.071 111.636 720.798 109.455C721.548 107.273 721.923 104.75 721.923 101.886C721.923 98.9773 721.548 96.4318 720.798 94.25C720.071 92.0682 719.014 90.3636 717.628 89.1364C716.241 87.9091 714.548 87.2955 712.548 87.2955C710.48 87.2955 708.73 87.9091 707.298 89.1364C705.889 90.3636 704.81 92.0682 704.06 94.25C703.332 96.4318 702.969 98.9773 702.969 101.886C702.969 104.75 703.332 107.273 704.06 109.455C704.81 111.636 705.889 113.341 707.298 114.568C708.73 115.795 710.48 116.409 712.548 116.409ZM764.111 98.1364V128H747.44V75.6364H763.293V85.25H763.872C765.031 82.0455 767.009 79.5341 769.804 77.7159C772.599 75.875 775.929 74.9545 779.793 74.9545C783.474 74.9545 786.668 75.7841 789.372 77.4432C792.099 79.0795 794.213 81.375 795.713 84.3295C797.236 87.2614 797.986 90.6932 797.963 94.625V128H781.293V97.8977C781.315 94.9886 780.577 92.7159 779.077 91.0795C777.599 89.4432 775.543 88.625 772.906 88.625C771.156 88.625 769.611 89.0114 768.27 89.7841C766.952 90.5341 765.929 91.6136 765.202 93.0227C764.497 94.4318 764.134 96.1364 764.111 98.1364ZM837.841 75.6364V87.9091H804.807V75.6364H837.841ZM811.727 63.0909H828.398V111.534C828.398 112.557 828.557 113.386 828.875 114.023C829.216 114.636 829.705 115.08 830.341 115.352C830.977 115.602 831.739 115.727 832.625 115.727C833.261 115.727 833.932 115.67 834.636 115.557C835.364 115.42 835.909 115.307 836.273 115.216L838.795 127.25C838 127.477 836.875 127.761 835.42 128.102C833.989 128.443 832.273 128.659 830.273 128.75C826.364 128.932 823.011 128.477 820.216 127.386C817.443 126.273 815.318 124.545 813.841 122.205C812.386 119.864 811.682 116.92 811.727 113.375V63.0909ZM846.347 128V75.6364H862.54V85.1818H863.085C864.04 81.7273 865.597 79.1591 867.756 77.4773C869.915 75.7727 872.426 74.9205 875.29 74.9205C876.063 74.9205 876.858 74.9773 877.676 75.0909C878.494 75.1818 879.256 75.3295 879.96 75.5341V90.0227C879.165 89.75 878.119 89.5341 876.824 89.375C875.551 89.2159 874.415 89.1364 873.415 89.1364C871.438 89.1364 869.653 89.5795 868.062 90.4659C866.494 91.3295 865.256 92.5455 864.347 94.1136C863.46 95.6591 863.017 97.4773 863.017 99.5682V128H846.347ZM908.477 128.989C902.977 128.989 898.25 127.864 894.295 125.614C890.364 123.341 887.33 120.182 885.193 116.136C883.08 112.068 882.023 107.352 882.023 101.989C882.023 96.6023 883.08 91.8864 885.193 87.8409C887.33 83.7727 890.364 80.6136 894.295 78.3636C898.25 76.0909 902.977 74.9545 908.477 74.9545C913.977 74.9545 918.693 76.0909 922.625 78.3636C926.58 80.6136 929.614 83.7727 931.727 87.8409C933.864 91.8864 934.932 96.6023 934.932 101.989C934.932 107.352 933.864 112.068 931.727 116.136C929.614 120.182 926.58 123.341 922.625 125.614C918.693 127.864 913.977 128.989 908.477 128.989ZM908.58 116.409C910.58 116.409 912.273 115.795 913.659 114.568C915.045 113.341 916.102 111.636 916.83 109.455C917.58 107.273 917.955 104.75 917.955 101.886C917.955 98.9773 917.58 96.4318 916.83 94.25C916.102 92.0682 915.045 90.3636 913.659 89.1364C912.273 87.9091 910.58 87.2955 908.58 87.2955C906.511 87.2955 904.761 87.9091 903.33 89.1364C901.92 90.3636 900.841 92.0682 900.091 94.25C899.364 96.4318 899 98.9773 899 101.886C899 104.75 899.364 107.273 900.091 109.455C900.841 111.636 901.92 113.341 903.33 114.568C904.761 115.795 906.511 116.409 908.58 116.409ZM960.142 58.1818V128H943.472V58.1818H960.142ZM987.423 58.1818V128H970.753V58.1818H987.423Z" fill="currentColor"/>
              <path d="M78.9707 3C68.4137 3 62.04 39.7202 62.04 55.0787C62.04 68.8021 66.6883 60.8267 75.6747 58.9729C76.7454 58.752 77.8468 58.6181 78.9707 58.6181C80.0947 58.6181 81.1961 58.752 82.2668 58.9729C91.2532 60.8267 95.9015 68.8021 95.9015 55.0787C95.9015 39.7202 89.5278 3 78.9707 3Z" fill="#876F45"/>
              <path d="M75.2605 132.944H82.6809C85.9529 132.944 75.2605 89.8193 82.2668 58.9729C81.1961 58.752 80.0947 58.6181 78.9707 58.6181C77.8468 58.6181 76.7454 58.752 75.6747 58.9729C62.04 87.3496 71.9886 132.944 75.2605 132.944Z" fill="#876F45"/>
              <path d="M75.2605 132.944C80.1372 132.944 77.8043 132.944 82.6809 132.944M75.2605 132.944C71.9886 132.944 62.04 87.3496 75.6747 58.9729M75.2605 132.944H82.6809M82.6809 132.944C85.9529 132.944 75.2605 89.8193 82.2668 58.9729M82.2668 58.9729C91.2532 60.8267 95.9015 68.8021 95.9015 55.0787C95.9015 39.7202 89.5278 3 78.9707 3C68.4137 3 62.04 39.7202 62.04 55.0787C62.04 68.8021 66.6883 60.8267 75.6747 58.9729M82.2668 58.9729C81.1961 58.752 80.0947 58.6181 78.9707 58.6181C77.8468 58.6181 76.7454 58.752 75.6747 58.9729" stroke="currentColor" fill="none" stroke-width="6"/>
              <path d="M134.861 10.1729C144.826 13.2239 136.988 49.7265 131.194 64.2235C126.016 77.1771 124.637 68.3057 116.854 63.9588C115.927 63.4409 114.938 62.9961 113.877 62.6713C112.816 62.3465 111.726 62.1546 110.632 62.0537C101.45 61.2064 94.0539 67.391 99.2314 54.4375C105.026 39.9404 124.896 7.12184 134.861 10.1729Z" fill="#876F45"/>
              <path d="M89.3375 133.901L82.3333 131.756C79.2449 130.81 105.608 93.1947 110.632 62.0537C111.726 62.1546 112.816 62.3465 113.877 62.6713C114.938 62.9961 115.927 63.4409 116.854 63.9588C119.018 94.6843 92.4259 134.846 89.3375 133.901Z" fill="#876F45"/>
              <path d="M89.3375 133.901C84.7344 132.491 86.9364 133.165 82.3333 131.756M89.3375 133.901C92.4259 134.846 119.018 94.6843 116.854 63.9588M89.3375 133.901L82.3333 131.756M82.3333 131.756C79.2449 130.81 105.608 93.1947 110.632 62.0537M110.632 62.0537C101.45 61.2064 94.0539 67.391 99.2314 54.4375C105.026 39.9404 124.896 7.12184 134.861 10.1729C144.826 13.2239 136.988 49.7265 131.194 64.2235C126.016 77.1771 124.637 68.3057 116.854 63.9588M110.632 62.0537C111.726 62.1546 112.816 62.3465 113.877 62.6713C114.938 62.9961 115.927 63.4409 116.854 63.9588" stroke="currentColor" fill="none" stroke-width="6"/>
              <path d="M69.1356 134.709L62.0183 136.546C58.88 137.357 55.1981 93.3459 38.5086 65.4939C39.4643 65.0169 40.4773 64.6157 41.5554 64.3375C42.6335 64.0592 43.7331 63.9151 44.8315 63.8618C67.0805 87.7041 72.2739 133.899 69.1356 134.709Z" fill="#876F45"/>
              <path d="M23.5801 10.9909C33.706 8.37724 51.687 42.0199 56.6508 56.7511C61.086 69.914 54.05 63.4151 44.8315 63.8618C43.7331 63.9151 42.6335 64.0592 41.5554 64.3375C40.4773 64.6157 39.4643 65.0169 38.5086 65.4939C30.4884 69.4967 28.6075 78.2971 24.1723 65.1343C19.2085 50.403 13.4541 13.6045 23.5801 10.9909Z" fill="#876F45"/>
              <path d="M69.1356 134.709C64.4582 135.917 66.6957 135.339 62.0183 136.546M69.1356 134.709C72.2739 133.899 67.0805 87.7041 44.8315 63.8618M69.1356 134.709L62.0183 136.546M62.0183 136.546C58.88 137.357 55.1981 93.3459 38.5086 65.4939M38.5086 65.4939C30.4884 69.4967 28.6075 78.2971 24.1723 65.1343C19.2085 50.403 13.4541 13.6045 23.5801 10.9909C33.706 8.37724 51.687 42.0199 56.6508 56.7511C61.086 69.914 54.05 63.4151 44.8315 63.8618M38.5086 65.4939C39.4643 65.0169 40.4773 64.6157 41.5554 64.3375C42.6335 64.0592 43.7331 63.9151 44.8315 63.8618" stroke="currentColor" fill="none" stroke-width="6"/>
              <path d="M3 166C7.35398 160.789 14.696 158.184 29.1239 158.184C31.7181 158.184 34.0154 157.104 35.4448 155.808C40.601 151.135 55.3158 147.762 72.6636 147.762C83.4894 147.762 93.2898 149.076 100.382 151.199C107.688 153.386 116.742 155.578 124.911 155.578C139.339 155.578 148.858 159.486 151.035 163.395" stroke="currentColor" fill="none" stroke-width="6" stroke-linecap="round"/>
              <path d="M44.6761 156.881C44.6761 156.881 46.9068 157.13 48.9064 157.353C50.906 157.576 53.1367 158.297 53.1367 158.297" stroke="currentColor" fill="none" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>

          </div>
        </router-link>
    

      </div>

      <!-- Desktop admin info -->
      <div class="hidden sm:flex items-center space-x-4" v-if="isAdmin">
        <div :class="['flex items-center space-x-1 text-xs font-medium px-3 py-1 rounded-full text-text1', getRoleClass(role)]">
          <ShieldCheck class="w-4 h-4" />
          <span class="capitalize">{{ role.toLowerCase() }}</span>
        </div>
        <span class="text-sm font-semibold truncate">{{ username }}</span>
        <div class="relative">
          <button
              @click="toggleDropdown"
              class="w-10 h-10 rounded-full bg-button hover:bg-button-hover flex items-center justify-center"
          >
            <span class="text-white font-bold uppercase">{{ role.charAt(0) }}</span>
          </button>
          <div
              v-if="dropdownOpen"
              class="absolute right-0 mt-2 top-full w-40 bg-white rounded-md shadow-lg z-50 text-left"
          >
            <ul class="py-2 text-sm text-gray-700">
              <li>
                <button @click="logout" class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button>
                <button @click="settings" class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button>
                <ThemeSwitcher class="block w-full text-left px-4 py-2 hover:bg-gray-100"></ThemeSwitcher>
                <CursorSwitcher></CursorSwitcher>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Mobile hamburger -->
      <div class="sm:hidden relative">
        <button @click="toggleMobileMenu">
          <Menu class="w-6 h-6 text-text hover:text-button" />
        </button>

        <div
            v-if="mobileMenuOpen"
            class="absolute right-0 top-full mt-2 w-48 bg-white text-black rounded-md shadow-md z-50"
        >
          <div v-if="isAdmin" class="p-4 border-b">
            <div :class="['flex items-center space-x-1 text-xs font-medium px-3 py-1 rounded-full text-white', getRoleClass(role)]">
              <ShieldCheck class="w-4 h-4" />
              <span class="capitalize">{{ role.toLowerCase() }}</span>
            </div>
            <p class="text-sm mt-1">{{ username }}</p>
          </div>
          <ul class="text-sm">
            <li>
              <button @click="settings" class="block w-full text-left px-4 py-2 hover:bg-gray-100">Settings</button>
              <button @click="logout" class="block w-full text-left px-4 py-2 hover:bg-gray-100">Log out</button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</template>


<script setup>
import {ref, computed, onMounted, onBeforeUnmount} from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { parseJwt } from '../../utils/jwt.js';
import { ShieldCheck, Menu } from 'lucide-vue-next';
import ThemeSwitcher from "@/components/ThemeSwitcher.vue";


const router = useRouter();
const route = useRoute();

const dropdownOpen = ref(false);
ref(null);
const token = sessionStorage.getItem('jwt');
const role = ref(null);
const username = ref(null);
const mobileMenuOpen = ref(false);

onMounted(() => {
  if (token) {
    const decoded = parseJwt(token);
    role.value = decoded?.role;
    username.value = decoded?.sub;
  }
  document.addEventListener('click', handleClickOutsideDropdown);
})

onBeforeUnmount(() => {
  document.removeEventListener('click', handleClickOutsideDropdown); 
})

const isAdmin = computed(() =>
    role.value === 'SUPERUSER' || role.value === 'MODERATOR'
);

const showBackButton = computed(() => {
  return route.path !== '/' && route.path !== '/admin/dashboard';
});

const toggleMobileMenu = () => {
  mobileMenuOpen.value = !mobileMenuOpen.value;
};

const goBack = () => router.back();

const toggleDropdown = () => {
  dropdownOpen.value = !dropdownOpen.value;
};

const handleClickOutsideDropdown = (e) => {
  if (!e.target.closest('.relative')) {
    dropdownOpen.value = false;
    mobileMenuOpen.value = false;
  }
};

const logout = () => {
  sessionStorage.removeItem('jwt');
  router.push('/admin/login');
};

const settings = () => {
  router.push('/admin/settings');
};

const getRoleClass = (role) => {
  switch (role) {
    case 'SUPERUSER':
      return 'bg-role-superuser';
    case 'MODERATOR':
      return 'bg-role-moderator';
    default:
      return 'bg-gray-400';
  }
};

</script>
